<!DOCTYPE html>
<html>
<meta charset="UTF-8" />
<title>Memento</title>
<meta name="description" content="Memento 패턴

Memento 패턴

왜쓸까

등장인물

Originator(작성자)의 역할

Memento(기억)의 역할

Caretaker(관리인)의 역할

예제 코드

" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="//fonts.googleapis.com/css?family=Rubik|Unica+One" rel="stylesheet" />
<link rel="stylesheet" href=".\static/css/normalize.css?cfef39a759eb9a87" />
<link rel="stylesheet" href=".\static/css/flexboxgrid.min.css?cfef39a759eb9a87" />
<link rel="stylesheet" href=".\static/css/github-flavored-markdown.css?cfef39a759eb9a87" />
<link rel="stylesheet" href=".\static/css/light.css?cfef39a759eb9a87" />
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css" />
<style>
    body,
    .markdown-body {
        font-family: "Rubik|Unica+One", -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }
</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src=".\static/main.js?cfef39a759eb9a87"></script>

<body>
    <div id="root">
        <div class="wrap container-fluid">
            <header class="site-header">
                <h1>
                    <a href="/GOF-DesignPattern/">flybook</a>
                </h1>
                <nav class="nav-link">
                    <a href="/GOF-DesignPattern/">Home</a>
                    <a href="https://hearimm.github.io/GOF-DesignPattern/">Git</a>
                    <a href="#" class="more">
                        <svg aria-hidden="true" class="octicon" height="24" version="1.1" viewBox="0 0 12 16" width="18">
                            <path d="M11.41 9H.59C0 9 0 8.59 0 8c0-.59 0-1 .59-1H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1h.01zm0-4H.59C0 5 0 4.59 0 4c0-.59 0-1 .59-1H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1h.01zM.59 11H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1H.59C0 13 0 12.59 0 12c0-.59 0-1 .59-1z"></path>
                        </svg>
                    </a>
                </nav>
            </header>
            <section class="row main">
                <aside class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                    <div class="chap">
                        <span class="chap-title"></span>
                        <ul>
                            <li class="">
                                <a href="adaptor.html">Adaptor</a>
                            </li>
                            <li class="">
                                <a href="iterator.html">Iterator</a>
                            </li>
                            <li class="">
                                <a href="template.html">Template</a>
                            </li>
                            <li class="">
                                <a href="abstractFactory.html">Abstractfactory</a>
                            </li>
                            <li class="">
                                <a href="bridge.html">Bridge</a>
                            </li>
                            <li class="">
                                <a href="builder.html">Builder</a>
                            </li>
                            <li class="">
                                <a href="chainOfResponsibility.html">Chainofresponsibility</a>
                            </li>
                            <li class="">
                                <a href="Command.html">Command</a>
                            </li>
                            <li class="">
                                <a href="effectiveJavaBuild.html">Effectivejavabuild</a>
                            </li>
                            <li class="">
                                <a href="facade.html">Facade</a>
                            </li>
                            <li class="">
                                <a href="factoryMethod.html">Factorymethod</a>
                            </li>
                            <li class="">
                                <a href="flyWeight.html">Flyweight</a>
                            </li>
                            <li class="">
                                <a href="Interpreter.html">Interpreter</a>
                            </li>
                            <li class="">
                                <a href="mediator.html">Mediator</a>
                            </li>
                            <li class="active">
                                <a href="memento.html">Memento</a>
                            </li>
                            <li class="">
                                <a href="observer.html">Observer</a>
                            </li>
                            <li class="">
                                <a href="prototype.html">Prototype</a>
                            </li>
                            <li class="">
                                <a href="proxy.html">Proxy</a>
                            </li>
                            <li class="">
                                <a href="singleton.html">Singleton</a>
                            </li>
                            <li class="">
                                <a href="state.html">State</a>
                            </li>
                            <li class="">
                                <a href="visitor.html">Visitor</a>
                            </li>
                        </ul>
                    </div>
                </aside>
                <article class="col-xs-12 col-sm-9 col-md-9 col-lg-9">
                    <div class="markdown-body">
                        <h1 id="memento-패턴">
                            <a href="#memento-%ED%8C%A8%ED%84%B4" aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>Memento 패턴</h1>
                        <ul>
                            <li>
                                <p>
                                    <a href="#memento-%ED%8C%A8%ED%84%B4">Memento 패턴</a>
                                </p>
                                <ul>
                                    <li>
                                        <a href="#%EC%99%9C%EC%93%B8%EA%B9%8C">왜쓸까</a>
                                    </li>
                                    <li>
                                        <p>
                                            <a href="#%EB%93%B1%EC%9E%A5%EC%9D%B8%EB%AC%BC">등장인물</a>
                                        </p>
                                        <ul>
                                            <li>
                                                <a href="#originator%EC%9E%91%EC%84%B1%EC%9E%90%EC%9D%98-%EC%97%AD%ED%95%A0">Originator(작성자)의 역할</a>
                                            </li>
                                            <li>
                                                <a href="#memento%EA%B8%B0%EC%96%B5%EC%9D%98-%EC%97%AD%ED%95%A0">Memento(기억)의 역할</a>
                                            </li>
                                            <li>
                                                <a href="#caretaker%EA%B4%80%EB%A6%AC%EC%9D%B8%EC%9D%98-%EC%97%AD%ED%95%A0">Caretaker(관리인)의 역할</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a href="#%EC%98%88%EC%A0%9C-%EC%BD%94%EB%93%9C">예제 코드</a>
                                    </li>
                                    <li>
                                        <p>
                                            <a href="#%EB%8F%85%EC%9E%90%EC%9D%98-%EC%82%AC%EA%B3%A0%EB%A5%BC-%EB%84%93%ED%9E%88%EA%B8%B0-%EC%9C%84%ED%95%9C-%ED%9E%8C%ED%8A%B8">독자의 사고를 넓히기 위한 힌트</a>
                                        </p>
                                        <ul>
                                            <li>
                                                <a href="#memento-%ED%81%B4%EB%9E%98%EC%8A%A4%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%EB%90%98%EA%B3%A0-%EC%9E%88%EB%8A%94-%EC%95%A1%EC%84%B8%EC%8A%A4-%EC%A0%9C%EC%96%B4">Memento 클래스에서 사용되고 있는 액세스 제어</a>
                                            </li>
                                            <li>
                                                <a href="#memento%EB%A5%BC-%EB%AA%87-%EA%B0%9C-%EA%B0%80%EC%A7%88%EA%B9%8C">Memento를 몇 개 가질까?</a>
                                            </li>
                                            <li>
                                                <a href="#memento%EC%9D%98-%EC%9C%A0%ED%9A%A8%EA%B8%B0%EA%B0%84%EC%9D%80">Memento의 유효기간은?</a>
                                            </li>
                                            <li>
                                                <a href="#caretaker-%EC%97%AD%ED%95%A0%EA%B3%BC-originator-%EC%97%AD%ED%95%A0%EC%9D%84-%EB%B6%84%EB%A6%AC%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0">Caretaker 역할과 Originator 역할을 분리하는 이유</a>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <p>
                            <img src="https://upload.wikimedia.org/wikipedia/commons/3/38/W3sDesign_Memento_Design_Pattern_UML.jpg" alt="UML">
                        </p>
                        <h2 id="왜쓸까">
                            <a href="#%EC%99%9C%EC%93%B8%EA%B9%8C" aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>왜쓸까</h2>
                        <p>저장한 정보를 가지고 RollBack(undo) 하는 패턴</p>
                        <p>RollBack을 하려면? 1. 기존 인스턴스 정보를 저장 1. 인스턴스 내부에 접근해 기존 정보를 꽂아줘야 함.</p>
                        <p>이렇게 내부의 정보를 자유롭게 액세스 하다보면, 원하지 않는 액세스를 허용해야 할 수도 있다. 이것을
                            <code>캡슈화의 파괴</code>라고 합니다.</p>
                        <p>인스턴스의 상태를 나타내는 역할을 도입해서, 캡슐화의 파괴에 빠지지 않고, 저장과 복원을 실행하는 것이 Memento 패턴의 목적입니다.</p>
                        <h2 id="등장인물">
                            <a href="#%EB%93%B1%EC%9E%A5%EC%9D%B8%EB%AC%BC" aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>등장인물</h2>
                        <h3 id="originator작성자의-역할">
                            <a href="#originator%EC%9E%91%EC%84%B1%EC%9E%90%EC%9D%98-%EC%97%AD%ED%95%A0" aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>Originator(작성자)의 역할</h3>
                        <p>Originator는 Memento를 만들고, 자기를 과거 Memento로 돌리는 처리를 실행합니다. 예제 : Gamer</p>
                        <h3 id="memento기억의-역할">
                            <a href="#memento%EA%B8%B0%EC%96%B5%EC%9D%98-%EC%97%AD%ED%95%A0" aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>Memento(기억)의 역할</h3>
                        <p>Memento의 역할은 Originator의 내부정보를 기억합니다.</p>
                        <p>정보를 누구에게도 공개하지 않습니다.</p>
                        <p>Memento역할은 두가지 인터페이스를 가집니다.</p>
                        <ol>
                            <li>
                                <p>wide interface</p>
                                <p>오브젝트의 상태를 원래상태로 돌리기 위해 필요한 정보를 모두 얻을 수 잇는 메소드의 집합.</p>
                                <p>Memento 역할의 내부 상태를 속속들이 들어내기 때문에 이것을 사용하는 것은 Originator 역할뿐입니다.</p>
                            </li>
                            <li>
                                <p>narrow interface</p>
                                <p>외부의 Carelaker 역할에게 보여주는 것</p>
                                <p>이 interface 로 할 수 있는일에 한계를 두고, 내부상태가 외부에 공개되는것을 방지 합니다.</p>
                            </li>
                        </ol>
                        <h3 id="caretaker관리인의-역할">
                            <a href="#caretaker%EA%B4%80%EB%A6%AC%EC%9D%B8%EC%9D%98-%EC%97%AD%ED%95%A0" aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>Caretaker(관리인)의 역할</h3>
                        <p>Caretaker역할은 Originator에게 Memento를 지금 저장해서 달라고 요청합니다.</p>
                        <p>그렇게 받은 Memento를 관리합니다. (예제는 필드 1개지만, Collection으로 관리 가능)</p>
                        <p>하지만 Memento 내부엔 접근할 수 있는건 최소한의 narrow interface부분들 뿐입니다.</p>
                        <p>필요할때 꺼내서, Originator에게 전달해 복원하도록 합니다.</p>
                        <h2 id="예제-코드">
                            <a href="#%EC%98%88%EC%A0%9C-%EC%BD%94%EB%93%9C" aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>예제 코드</h2>
                        <pre><code class="language-java">    package game;

    import java.util.ArrayList;

    public class Memento {
        int money; // 소지금
        ArrayList&#x3C;String> fruits; // 과일

        Memento(int money) { // 생성자
            this.money = money;
            this.fruits = new ArrayList&#x3C;String>();
        }

        public int getMoney() { // 소지금을 얻는다. (얘만 public - main 조회용)
            return money;
        }

        ArrayList&#x3C;String> getFruit() {
            return fruits;
        }

        void addFruit(String fruit) {
            this.fruits.add(fruit);
        }
    }
</code></pre>
                        <pre><code class="language-java">    package game;

    import java.util.*;

    public class Gamer {
        private int money;
        private List&#x3C;String> fruits = new ArrayList&#x3C;String>();
        private Random random = new Random();
        private static String[] fruitsname = { "사과", "포도", "바나나", "귤" };

        public Gamer(int money) {
            this.money = money;
        }

        public int getMoney() {
            return money;
        }

        public void bet() {
            int dice = random.nextInt(6) + 1; //주사위 던지기
            if (dice == 1) {
                money += 100;
                System.out.println("소지금이 증가했다.");
            } else if (dice == 2) {
                money /= 2;
                System.out.println("소지금이 절반이 되었다.");
            } else if (dice == 6) {
                String f = getFruit();
                System.out.println("과일(" + f + ")를 받았다.");
                fruits.add(f);
            } else {
                System.out.println("pass");
            }
        }

        public Memento createMemento() { // memento 저장
            Memento m = new Memento(money);
            Iterator&#x3C;String> it = fruits.iterator();
            while (it.hasNext()) {
                String f = it.next();
                String prefix = "맛있는 "; // 맛있는것만 저장
                if (f.startsWith(prefix)) {
                    m.addFruit(f);
                }
            }
            return m;
        }

        public void restoreMemento(Memento memento) { // 기존 memento에서 복구
            this.money = memento.money;
            this.fruits = memento.getFruit();
        }

        private String getFruit() {
            String prefix = "";
            if (random.nextBoolean()) {
                prefix = "맛있는 ";
            }
            return prefix + fruitsname[random.nextInt(fruitsname.length)];
        }

        @Override
        public String toString() {
            return "Gamer [money=" + money + ", fruits=" + fruits + "]";
        }

    }
</code></pre>
                        <pre><code class="language-java">    import game.*;

    public class Main {
        public static void main(String[] args) {
            int money = 100;
            Gamer gamer = new Gamer(money);
            Memento memento = gamer.createMemento();

            for (int i = 0; i &#x3C; 50; i++) {
                System.out.println("=== "+ i);
                System.out.println("현재상태 : "+ gamer);

                gamer.bet(); // 게임을 시작하지..

                System.out.println("소지금은 " + gamer.getMoney() + "원");

                if(gamer.getMoney() > memento.getMoney()) {
                    System.out.println("많이 증가했다. 저장한다.");
                    memento = gamer.createMemento();
                } else if (gamer.getMoney() &#x3C; memento.getMoney() / 2) {
                    System.out.println("많이 감소했다. 복원한다.");
                    gamer.restoreMemento(memento);
                }
            }
            System.out.println("게임오버 : "+ gamer);
        }
    }

        /* 결과
        === 45
        현재상태 : Gamer [money=500, fruits=[맛있는 바나나, 맛있는 포도, 포도]]
        과일(맛있는 포도)를 받았다.
        소지금은 500원
        === 46
        현재상태 : Gamer [money=500, fruits=[맛있는 바나나, 맛있는 포도, 포도, 맛있는 포도]]
        소지금이 절반이 되었다.
        소지금은 250원
        많이 감소했다. 복원한다.
        === 47
        현재상태 : Gamer [money=800, fruits=[맛있는 바나나, 맛있는 포도]]
        pass
        소지금은 800원
        === 48
        현재상태 : Gamer [money=800, fruits=[맛있는 바나나, 맛있는 포도]]
        소지금이 증가했다.
        소지금은 900원
        많이 증가했다. 저장한다.
        === 49
        현재상태 : Gamer [money=900, fruits=[맛있는 바나나, 맛있는 포도]]
        pass
        소지금은 900원
        게임오버 : Gamer [money=900, fruits=[맛있는 바나나, 맛있는 포도]]

        */
</code></pre>
                        <h2 id="독자의-사고를-넓히기-위한-힌트">
                            <a href="#%EB%8F%85%EC%9E%90%EC%9D%98-%EC%82%AC%EA%B3%A0%EB%A5%BC-%EB%84%93%ED%9E%88%EA%B8%B0-%EC%9C%84%ED%95%9C-%ED%9E%8C%ED%8A%B8"
                                aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>독자의 사고를 넓히기 위한 힌트</h2>
                        <h3 id="memento-클래스에서-사용되고-있는-액세스-제어">
                            <a href="#memento-%ED%81%B4%EB%9E%98%EC%8A%A4%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%EB%90%98%EA%B3%A0-%EC%9E%88%EB%8A%94-%EC%95%A1%EC%84%B8%EC%8A%A4-%EC%A0%9C%EC%96%B4"
                                aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>Memento 클래스에서 사용되고 있는 액세스 제어</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>액세스제어</th>
                                    <th>필드 메소드 생성자</th>
                                    <th>누구에게 보이지?</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>없음</td>
                                    <td>money</td>
                                    <td>Memento, Gamer</td>
                                </tr>
                                <tr>
                                    <td>없음</td>
                                    <td>fruits</td>
                                    <td>Memento, Gamer</td>
                                </tr>
                                <tr>
                                    <td>public</td>
                                    <td>getMoney</td>
                                    <td>Memento, Gamer, Main</td>
                                </tr>
                                <tr>
                                    <td>없음</td>
                                    <td>Memento</td>
                                    <td>Memento, Gamer</td>
                                </tr>
                                <tr>
                                    <td>없음</td>
                                    <td>addFruit</td>
                                    <td>Memento, Gamer</td>
                                </tr>
                            </tbody>
                        </table>
                        <p>getMoney 메소드에만 public 을 붙여서 narrow interface로 사용하고 있습니다.</p>
                        <p>Main클래스와 패키지가 달라 접근이 불가능.</p>
                        <h3 id="memento를-몇-개-가질까">
                            <a href="#memento%EB%A5%BC-%EB%AA%87-%EA%B0%9C-%EA%B0%80%EC%A7%88%EA%B9%8C" aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>Memento를 몇 개 가질까?</h3>
                        <p>예제는 Main클래스가 갖고 있는 1개지만, 배열들을 사용해 여러 인스턴스의 상태를 저장할 수 있습니다.</p>
                        <h3 id="memento의-유효기간은">
                            <a href="#memento%EC%9D%98-%EC%9C%A0%ED%9A%A8%EA%B8%B0%EA%B0%84%EC%9D%80" aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>Memento의 유효기간은?</h3>
                        <p>예제같이 메모리상에만 저장할 경우 별로 문제가 없지만, 파일로 지속적으로 저장할 경우, 유효기간이 문제가 될 수 있습니다.</p>
                        <p>버전업등으로 구조가 바뀐다던지. 등</p>
                        <h3 id="caretaker-역할과-originator-역할을-분리하는-이유">
                            <a href="#caretaker-%EC%97%AD%ED%95%A0%EA%B3%BC-originator-%EC%97%AD%ED%95%A0%EC%9D%84-%EB%B6%84%EB%A6%AC%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0"
                                aria-hidden="true">
                                <span class="icon icon-link"></span>
                            </a>Caretaker 역할과 Originator 역할을 분리하는 이유</h3>
                        <p>스냅샷을찍고, Memento 관리를 Originator가 직접 다 하면 안될까?</p>
                        <p>이렇게 역할 분담을 해두면,</p>
                        <ol>
                            <li>여러 단계의 undo를 실행하도록 변경하고 싶다.</li>
                            <li>undo 기능뿐만 아니라 현재의 상태를 파일에 저장하고싶다. 등등</li>
                        </ol>
                        <p>여러 수정사항이 생길때마다, Originator를 수정하지 않고, Caretaker만 수정해 사용이 가능합니다.</p>
                    </div>
                </article>
            </section>
            <footer>© 2017
                <a>flybook</a>. All rights reserved.</footer>
        </div>
    </div>
</body>

</html>